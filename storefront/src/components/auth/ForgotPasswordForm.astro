---
/**
 * ForgotPasswordForm Component
 * Reusable forgot password form component
 */

// Import auth store functions
import { forgotPassword } from "../../stores/auth";
import { showSuccessToast, showErrorToast } from "../../lib/toast";
---

<div class="forgot-password-form" id="forgot-password-form-container">
    <form id="forgot-password-form" class="space-y-6">
        <!-- Email Field -->
        <div>
            <label
                for="email"
                class="block text-sm font-medium text-gray-700 mb-1"
            >
                Email Address
            </label>
            <input
                type="email"
                id="email"
                name="email"
                autocomplete="email"
                required
                placeholder="Enter your email address"
                class="appearance-none block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm transition-colors"
            />
            <p class="mt-2 text-sm text-gray-500">
                We'll send you a link to reset your password.
            </p>
        </div>

        <!-- Submit Button -->
        <div>
            <button
                type="submit"
                id="submit-btn"
                class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200"
            >
                <span id="btn-text">Send Reset Link</span>
                <svg
                    id="loading-spinner"
                    class="animate-spin ml-2 h-5 w-5 text-white hidden"
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                >
                    <circle
                        class="opacity-25"
                        cx="12"
                        cy="12"
                        r="10"
                        stroke="currentColor"
                        stroke-width="4"></circle>
                    <path
                        class="opacity-75"
                        fill="currentColor"
                        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                    ></path>
                </svg>
            </button>
        </div>
    </form>

    <!-- Back to Sign In Link -->
    <div class="mt-6 text-center text-sm text-gray-600">
        Remember your password?
        <a
            href="/auth/signin"
            class="font-medium text-indigo-600 hover:text-indigo-500 transition-colors"
        >
            Sign in
        </a>
    </div>
</div>

<script>
    import { forgotPassword } from "../../stores/auth";
    import { showSuccessToast, showErrorToast } from "../../lib/toast";

    const form = document.getElementById(
        "forgot-password-form",
    ) as HTMLFormElement;
    const emailInput = document.getElementById("email") as HTMLInputElement;
    const submitBtn = document.getElementById(
        "submit-btn",
    ) as HTMLButtonElement;
    const btnText = document.getElementById("btn-text") as HTMLSpanElement;
    const loadingSpinner = document.getElementById(
        "loading-spinner",
    ) as unknown as SVGElement;

    // Handle form submission
    form?.addEventListener("submit", async (e) => {
        e.preventDefault();

        const email = emailInput?.value;

        if (!email) {
            showErrorToast("Please enter your email address");
            return;
        }

        // Show loading state
        if (submitBtn) {
            submitBtn.disabled = true;
            btnText.textContent = "Sending...";
            loadingSpinner?.classList.remove("hidden");
        }

        try {
            await forgotPassword(email);

            showSuccessToast(
                "Password reset link sent! Check your email for instructions.",
            );

            // Clear form
            if (emailInput) {
                emailInput.value = "";
            }

            // Reset button state
            if (submitBtn) {
                submitBtn.disabled = false;
                btnText.textContent = "Send Reset Link";
                loadingSpinner?.classList.add("hidden");
            }
        } catch (error: any) {
            console.error("Forgot password error:", error);
            showErrorToast(
                error.message || "Failed to send reset link. Please try again.",
            );

            // Reset button state
            if (submitBtn) {
                submitBtn.disabled = false;
                btnText.textContent = "Send Reset Link";
                loadingSpinner?.classList.add("hidden");
            }
        }
    });
</script>

<style>
    .forgot-password-form input:focus {
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }

    .forgot-password-form button[type="submit"]:hover:not(:disabled) {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
    }

    @keyframes spin {
        to {
            transform: rotate(360deg);
        }
    }

    .animate-spin {
        animation: spin 1s linear infinite;
    }
</style>
